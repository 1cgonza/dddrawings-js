!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.dddrawings=e():t.dddrawings=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e){t.exports="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aAlpha;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vAlpha;\n\nvoid main(void){\n  float cosine = cos(aRotation);\n  float sine = sin(aRotation);\n\n  vec3 v;\n  v.x = aVertexPosition.x * cosine - aVertexPosition.y * sine;\n  v.y = aVertexPosition.x * sine + aVertexPosition.y * cosine;\n  v.z = 1.0;\n\n  // Move\n  v.xy += aPositionCoord;\n\n  gl_Position = vec4(projectionMatrix * v, 1.0);\n\n  vTextureCoord = aTextureCoord;\n  vAlpha = aAlpha;\n}"},function(t,e){t.exports="precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying float vAlpha;\n\nuniform sampler2D uImage;\n\nvoid main(void){\n  vec4 color = texture2D(uImage, vTextureCoord) * vAlpha;\n  if (color.a == 0.0) discard;\n  gl_FragColor = color;\n}"},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.r(e),i.d(e,"PI",(function(){return f})),i.d(e,"TWO_PI",(function(){return d})),i.d(e,"HALF_PI",(function(){return y})),i.d(e,"QUARTER_PI",(function(){return v})),i.d(e,"toRad",(function(){return m})),i.d(e,"random",(function(){return p})),i.d(e,"sizeFromPercentage",(function(){return b})),i.d(e,"getPercent",(function(){return x})),i.d(e,"isPowerOfTwo",(function(){return g})),i.d(e,"Transform",(function(){return l})),i.d(e,"Point",(function(){return r})),i.d(e,"Rectangle",(function(){return a})),i.d(e,"Matrix",(function(){return o})),i.d(e,"Vector",(function(){return u})),i.d(e,"canvas",(function(){return w})),i.d(e,"yearsMenu",(function(){return T})),i.d(e,"resetCurrent",(function(){return E})),i.d(e,"base64",(function(){return k})),i.d(e,"json",(function(){return R})),i.d(e,"image",(function(){return P})),i.d(e,"audio",(function(){return S})),i.d(e,"DataRequest",(function(){return C})),i.d(e,"Map",(function(){return M})),i.d(e,"rgbToHex",(function(){return j})),i.d(e,"hexToRgb",(function(){return I})),i.d(e,"convertAlpha",(function(){return L})),i.d(e,"getRGBA",(function(){return O})),i.d(e,"Audio",(function(){return N})),i.d(e,"Stage",(function(){return B})),i.d(e,"Webgl",(function(){return Z}));var r=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e||0,this.y=i||0}var e,i,r;return e=t,(i=[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"copy",value:function(t){this.set(t.x,t.y)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"set",value:function(t,e){this.x=t||0,this.y=e||0!==e?this.x:0}}])&&n(e.prototype,i),r&&n(e,r),t}();var a=function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e||0,this.y=i||0,this.width=n||0,this.height=r||0};function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(e,i,n,r,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.a=e||1,this.b=i||0,this.c=n||0,this.d=r||1,this.tx=a||0,this.ty=s||0}var e,i,n;return e=t,(i=[{key:"toArray",value:function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}},{key:"apply",value:function(t,e){e=e||new r;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}},{key:"applyInverse",value:function(t,e){e=e||new r;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,a=t.y;return e.x=this.d*i*n+-this.c*i*a+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*a+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}},{key:"translate",value:function(t,e){return this.tx+=t,this.ty+=e,this}},{key:"scale",value:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}},{key:"append",value:function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}},{key:"setTransform",value:function(t,e,i,n,r,a,s){var o=Math.sin(s),h=Math.cos(s),u=h*r,c=o*r,l=-o*a,f=h*a;return this.a=u+l,this.b=c+f,this.c=u+l,this.d=c+f,this.tx=t+(i*u+n*l),this.ty=e+(i*c+n*f),this}},{key:"prepend",value:function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}},{key:"invert",value:function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*r)/a,this.ty=-(t*this.ty-e*r)/a,this}},{key:"identity",value:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}},{key:"clone",value:function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}},{key:"copy",value:function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}}])&&s(e.prototype,i),n&&s(e,n),t}();function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e||0,this.y=i||0,this.z=n||0}var e,i,n;return e=t,(i=[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"setLength",value:function(t){return this.multiplyScalar(t/this.length())}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"limit",value:function(t){return this.lengthSq()>t*t&&(this.normalize(),this.mult(t)),this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}}])&&h(e.prototype,i),n&&h(e,n),t}();function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()}var e,i,n;return e=t,(i=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"multiply",value:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=s}},{key:"invert",value:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=s}},{key:"rotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,r=this.m[1]*e+this.m[3]*i,a=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=s}},{key:"translate",value:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}},{key:"translateAndRotate",value:function(t,e,i){var n=Math.cos(i),r=Math.sin(i),a=this.m[0]*n+this.m[2]*r,s=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,h=this.m[1]*-r+this.m[3]*n;this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this.m[0]=a,this.m[1]=s,this.m[2]=o,this.m[3]=h}},{key:"scale",value:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}},{key:"transformPoint",value:function(t,e){var i=t,n=e;return[t=i*this.m[0]+n*this.m[2]+this.m[4],e=i*this.m[1]+n*this.m[3]+this.m[5]]}}])&&c(e.prototype,i),n&&c(e,n),t}(),f=Math.PI,d=2*f,y=f/2,v=f/4,m=f/180;function p(t,e,i){var n=Math.floor(Math.random()*(e-t))+t;return i&&(n=Math.random()*(e-t)+t),n}function b(t,e){return t/100*e}function x(t,e){return t/e*100}function g(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)}function w(t,e){var i=document.createElement("canvas"),n=i.getContext("2d");if(e=e||{},i.width=e.w||window.innerWidth,i.height=e.h||window.innerHeight,i.style.position=e.position||"absolute",i.style.top=e.top||0,i.style.left=e.left||0,i.style.zIndex=e.zi||9,e.css)for(var r in e.css)i.style[r]=e.css[r];return n.font=e.font||"12px Inconsolata",t&&t.appendChild(i),{container:t,canvas:i,w:i.width,h:i.height,ctx:n,center:{x:i.width/2,y:i.height/2}}}function T(t,e,i,n,r){var a=document.createElement("ul"),s="";a.id="years",a.style.zIndex=99999;for(var o=t;o<=e;o++){var h=document.createElement("li"),u=document.createTextNode(o);o===i&&(h.className="current",s=h),h.appendChild(u),a.appendChild(h),h.addEventListener("click",n,!1)}r(a,s)}function E(t,e,i){i=i||"current",t&&t.classList.remove(i),e.classList.add(i)}function k(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",n=0;n<t.length;){var r,a,s=255&t.charCodeAt(n++),o=255&t.charCodeAt(n++),h=255&t.charCodeAt(n++),u=s>>2,c=(3&s)<<4|o>>4;isNaN(o)?r=a=64:(r=(15&o)<<2|h>>6,a=isNaN(h)?64:63&h),i+=e.charAt(u)+e.charAt(c)+e.charAt(r)+e.charAt(a)}return i}function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function R(t){return(new C).json(t)}function P(t){var e=new C;return e.req.overrideMimeType("text/plain; charset=x-user-defined"),e.getD(t).then((function(t){return void 0!==t.ret?t:t.data})).catch((function(t){console.error(t)}))}function S(t){var e=new C;return e.req.responseType="arraybuffer",e.getD(t).then((function(t){return t})).catch((function(t){console.error("Error fetching audio file",t)}))}var C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.req=new XMLHttpRequest}var e,i,n;return e=t,(i=[{key:"abort",value:function(){this.req.abort()}},{key:"json",value:function(t){return this.req.overrideMimeType("application/json"),this.getD(t).then((function(t){return void 0!==t.ret?(t.data=JSON.parse(t.data),t):JSON.parse(t.data)})).catch((function(t){console.error("Error in data request, reason:",t)}))}},{key:"getD",value:function(t){if("object"===z(t)){if(!t.url)return void console.error("The request did not receive a url, instead got",t.url)}else"string"==typeof t&&t.length>0&&(t={url:t});var e,i,n=!1,r=this.req,a=t.loadingMsg||"Loading",s=t.container||document.body,o=s.querySelector(".loading");o||((o=document.createElement("div")).className="loading",s.appendChild(o));var h=!!t.loadingEle,u=h?t.loadingEle:null;if(!u){var c=s.querySelector(".loading-ele");(u=document.createElement("div")).className="loadingEle",c?o.insertBefore(c,u):o.appendChild(u)}function l(){u.style.opacity=1,o.style.zIndex=9,(e=u.querySelector(".loading-msg"))||((e=document.createElement("p")).className="loading-msg",e.innerText=a,u.appendChild(e))}function f(t){if(t.lengthComputable){n||(i=u.querySelector(".progress"))||((i=document.createElement("progress")).className="progress",i.style.zIndex=0,i.max=100,i.value=0,u.insertBefore(i,e),n=!0);var s=t.loaded/t.total*100;i.value=s,e.innerText=Math.floor(s)+"%\n"+a}else r.onprogress=null}function d(){h||(u.style.display="none"),o.style.zIndex=0}return new Promise((function(e,i){r.open("GET",t.url,!0),r.onloadstart=l,r.onprogress=f,r.onloadend=d,r.onload=function(){200===r.status?e({data:r.response,ret:t.ret}):i(r.statusText)},r.onerror=function(){i("Network Error")},r.send(null)}))}}])&&A(e.prototype,i),n&&A(e,n),t}();function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var M=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=e.width||window.innerWidth,n=e.height||window.innerHeight,r=e.zoom||11;e.center?this.center={lon:e.center.lon,lat:e.center.lat}:this.center={},this.hasCenter=null,this.updateSize(i,n,r)}var e,i,n;return e=t,(i=[{key:"updateSize",value:function(t,e,i){this.stageWidth=t,this.stageCenterY=e/2,this.zoom=i||this.zoom,this.zoomX=this.stageWidth*this.zoom,this.zoomY=this.stageCenterY*this.zoom,this.zoomRad=this.zoomX/360,this.newCenter(this.center.lon,this.center.lat)}},{key:"newCenter",value:function(t,e){this.hasCenter=!1,this.convertCoordinates(t,e),this.hasCenter=!0}},{key:"convertCoordinates",value:function(t,e){var i=+e*m,n=Math.log(Math.tan(v+i/2)),r=(+t+180)*this.zoomRad,a=this.zoomY-this.zoomX*n/d;return this.hasCenter?(r-=this.center.x,a-=this.center.y):(this.center.x=r,this.center.y=a),{x:r,y:a}}}])&&_(e.prototype,i),n&&_(e,n),t}();function j(t,e,i){return"0x"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}function I(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,n){return e+e+i+i+n+n}));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function L(t){return 1/(255/t)}function O(t,e){return"rgba("+t.r+","+t.g+","+t.b+","+e+")"}function D(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var N=function(){function t(e,i){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e||"[object Object]"!==Object.prototype.toString.call(e))return console.error("The first parameter needs to be an Object.","Example:","{audio1: 'audio1.mp3', audio2: 'audio2.mp3'}");window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=Object.keys(e).length,r=0,a={};for(var s in this.ctx=new AudioContext,e)S(e[s],o.bind(this),document.body);function o(t,e){this.ctx.decodeAudioData(t,function(t){if(!t)return void console.error("Error decoding audio file:",e);var s=this.ctx.createBufferSource();s.buffer=t,a[e]=s,++r===n&&i(a)}.bind(this),(function(t){console.error("decodeAudioData error",t)}))}}var e,i,n;return e=t,(i=[{key:"source",value:function(t){return(t=this.ctx.createBufferSource()).buffer=buffer,t.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),t}}])&&D(e.prototype,i),n&&D(e,n),t}();function U(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var B=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.children=[],this.texture={},this.data=e,this.renderer=i,this.loadImg(e.url),this.setBatchSize(n)}var e,i,n;return e=t,(i=[{key:"setBatchSize",value:function(t){t>16384&&(t=16384),t>15e3&&(t=15e3),this.batchSize=t}},{key:"renderWebGL",value:function(t){t.currentRenderer.render(this)}},{key:"bindTexture",value:function(){var t=this.renderer.gl,e=this.texture;return e.glTexture||(e.glTexture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,e.glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e.mipmap&&e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),!0}},{key:"loadImg",value:function(t){this.img=new Image,this.img.onload=this.imgLoaded.bind(this),this.img.src=t}},{key:"imgLoaded",value:function(){for(var t=this.img.naturalWidth,e=this.img.naturalHeight,i={loaded:!0,isPowerOfTwo:g(t,e)},n=[],r=0;r<this.data.frames.length;r++){var a=this.data.frames[r];n.push({width:a.w,height:a.h,uvs:[a.x/t,a.y/e,(a.x+a.w)/t,(a.y+a.h)/e]})}this.renderer.frames=n,this.texture=i,this.bindTexture(),this.data.cb&&this.data.cb()}},{key:"particle",value:function(t){return(t=t||{}).scale=t.scale||new r(1,1),t.alpha=t.alpha||1,t.rotation=t.rotation||0,t.x=t.x||0,t.y=t.y||0,t.frame=t.frame||0,this.children.push(t),this.children.length>this.batchSize&&this.setBatchSize(this.children.length),t}}])&&U(e.prototype,i),n&&U(e,n),t}();function F(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var X=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.size=new a(0,0,1,1),this.projectionMatrix=new o,this.resize(i,n)}var e,i,n;return e=t,(i=[{key:"resize",value:function(t,e){if(t|=0,e|=0,this.size.width!==t||this.size.height!==e){this.size.width=t,this.size.height=e;var i=this.projectionMatrix.identity();i.a=2/this.size.width,i.d=-2/this.size.height,i.tx=-1,i.ty=1}}}])&&F(e.prototype,i),n&&F(e,n),t}(),q=i(0),W=i.n(q),G=i(1),H=i.n(G);function Y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var V=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.uniforms={projectionMatrix:{}},this.attributes={};var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,W.a),e.compileShader(i);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,H.a),e.compileShader(n);var r=e.createProgram();e.attachShader(r,i),e.attachShader(r,n),e.linkProgram(r),e.deleteShader(i),e.deleteShader(n),this.program=r,e.useProgram(r),this.cacheUniformLocations(["projectionMatrix"]),this.cacheAttributeLocations(["aVertexPosition","aTextureCoord","aAlpha","aPositionCoord","aRotation"])}var e,i,n;return e=t,(i=[{key:"cacheUniformLocations",value:function(t){for(var e=0;e<t.length;++e)this.uniforms[t[e]]._location=this.gl.getUniformLocation(this.program,t[e])}},{key:"cacheAttributeLocations",value:function(t){for(var e=0;e<t.length;++e)this.attributes[t[e]]=this.gl.getAttribLocation(this.program,t[e])}}])&&Y(e.prototype,i),n&&Y(e,n),t}();function J(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var K=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=i,this.gl=e,this.start()}var e,i,n;return e=t,(i=[{key:"start",value:function(){var t=this.gl,e=new V(t);this.properties=[{attribute:e.attributes.aVertexPosition,size:2},{attribute:e.attributes.aPositionCoord,size:2},{attribute:e.attributes.aRotation,size:1},{attribute:e.attributes.aTextureCoord,size:2},{attribute:e.attributes.aAlpha,size:1}];for(var i=0;i<this.properties.length;i++)t.enableVertexAttribArray(i);var n=this.renderer.renderTarget.projectionMatrix;t.uniformMatrix3fv(e.uniforms.projectionMatrix._location,!1,n.toArray(!0))}},{key:"render",value:function(t){t.texture;var e=t.children,i=e.length,n=t.maxSize;this.size=t.batchSize;var r=this.gl;if(0!==i){if(i>n&&(i=n),!this.data){this.initBuffers();for(var a=0;a<this.properties.length;a++){var s=this.properties[a];r.vertexAttribPointer(s.attribute,s.size,r.FLOAT,!1,4*this.stride,4*s.offset)}}this.updateData(e,i),r.bufferSubData(r.ARRAY_BUFFER,0,this.data),r.drawElements(r.TRIANGLES,6*i,r.UNSIGNED_SHORT,0)}}},{key:"initBuffers",value:function(){var t=this.gl,e=0;this.stride=0;for(var i=0;i<this.properties.length;i++){var n=this.properties[i];n.offset=e,e+=n.size,this.stride+=n.size}this.data=new Float32Array(this.size*this.stride*4),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,this.data,t.DYNAMIC_DRAW);for(var r=6*this.size,a=new Uint16Array(r),s=(i=0,0);i<r;i+=6,s+=4)a[i]=s,a[i+1]=s+1,a[i+2]=s+2,a[i+3]=s,a[i+4]=s+2,a[i+5]=s+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW)}},{key:"updateData",value:function(t,e){this.stride;for(var i=0,n=this.data,r=this.renderer.frames,a=0;a<e;a++){var s=t[a],o=r[s.frame],h=o.width*s.scale,u=o.height*s.scale,c=s.x,l=s.y,f=s.rotation,d=o.uvs,y=s.alpha;n[i]=-h,n[++i]=-u,n[++i]=c,n[++i]=l,n[++i]=f,n[++i]=d[0],n[++i]=d[1],n[++i]=y,n[++i]=h,n[++i]=-u,n[++i]=c,n[++i]=l,n[++i]=f,n[++i]=d[2],n[++i]=d[1],n[++i]=y,n[++i]=h,n[++i]=u,n[++i]=c,n[++i]=l,n[++i]=f,n[++i]=d[2],n[++i]=d[3],n[++i]=y,n[++i]=-h,n[++i]=u,n[++i]=c,n[++i]=l,n[++i]=f,n[++i]=d[0],n[++i]=d[3],n[++i]=y,i++}}}])&&J(e.prototype,i),n&&J(e,n),t}();function Q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Z=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,i=i||{},this.width=i.width||window.innerWidth,this.height=i.height||window.innerHeight,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",e.appendChild(this.canvas);var n=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl",ctxOptions);this.gl=n,n.disable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.enable(n.BLEND),this.renderTarget=new X(n,this.width,this.height),this.currentRenderer=new K(n,this),this.resize(this.width,this.height)}var e,i,n;return e=t,(i=[{key:"render",value:function(t){t.renderWebGL(this)}},{key:"resize",value:function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e,this.gl.viewport(0,0,t,e)}}])&&Q(e.prototype,i),n&&Q(e,n),t}()}])}));